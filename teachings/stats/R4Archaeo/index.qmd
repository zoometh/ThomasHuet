---
title: "Report with R Markdown"
subtitle: "Report data analysis with R Markdown authoring framework<br>Theory"
author: "Thomas Huet, University of Oxford"
date: "`r format(Sys.time(), '%B %Y')`"
format:
  revealjs: 
    slide-number: true
    chalkboard: true
    scrollable: true
    logo: www/inst-uni-oxford_.png
    css: styles.css
    margin: 0.01
bibliography: references.bib
pagetitle: Report with R Markdown - Theory
footer: "Report with R Markdown <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/teachings/stats/R4Archaeo/www/logo.png' style='height: 40px;vertical-align: middle;'> Thomas Huet"
---

```{r echo=FALSE, eval=FALSE, out.width="50%", fig.align="center", fig.cap="R4Archaeologists"}
## Not run
# install.packages("archdata")
# install.packages("rmarkdown")
# install.packages("tinytex")
# install.packages("bookdown")
# install.packages("dplyr")
# install.packages("leaflet")
# install.packages("plotly")
# install.packages("rgl")
library(archdata)
library(rmarkdown)
library(tinytex)
library(bookdown)
library(dplyr)
library(leaflet)
library(plotly)
library(rgl)
```

## Introduction

::: {.panel-tabset}

### R Markdown

**R Markdown** is an authoring framework for data science (AFDS). It combines R code with narrative text. AFDS are used to create data-driven documents (reports) with a notebook interface.

* Code chunks are expressed with a local header, and a body part

* Narrative parts required principally the use of the Markdown syntax, but also supports HTML/CSS code, LaTeX syntax, etc.

### AFDS

Main authoring frameworks for data science (AFDS)

+------------------------------------------------------------------------------------------------------------------+------------+--------------------+
| AFDS                                                                                                             | Language   | Description        |
+==================================================================================================================+============+====================+
| Rmarkdown                                                                                                        | R          | front-end oriented |
+------------------------------------------------------------------------------------------------------------------+------------+--------------------+
| [Jupyter](https://hub.mybinder.turing.ac.uk/user/ipython-ipython-in-depth-qd7itkd2/notebooks/binder/Index.ipynb) | Python     | back-end oriented  |
+------------------------------------------------------------------------------------------------------------------+------------+--------------------+
| [D3.js](https://d3js.org/)                                                                                       | JavaScript | web oriented       |
+------------------------------------------------------------------------------------------------------------------+------------+--------------------+
| [Plotly](https://plotly.com/)                                                                                    | JavaScript | web oriented       |
+------------------------------------------------------------------------------------------------------------------+------------+--------------------+
:::

## Academic reporting

**R Markdown** is often enough for academic reporting It uses Markdown syntax, supports HTML/CSS markup languages, LaTeX, BibTex references, 3D plots, interactive maps, etc.

## Main packages

+------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| package                                                                                  | description                                                                                                                                                  |
+==========================================================================================+==============================================================================================================================================================+
| ![](https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg-knitr.png){width=70px}     | [knitr](https://yihui.org/knitr/) engine for dynamic report generation with R (e.g. convert to LaTeX)                                                      |
+------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ![](https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg-rmarkdown.png){width=70px} | [rmarkdown](https://cran.r-project.org/web/packages/rmarkdown/index.html) convert R Markdown documents into a variety of formats, extension of {`knitr`} |
+------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ![](https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg-tinytex.png){width=70px}   | [tinytex](https://yihui.org/tinytex/) typesetting system for LaTeX syntax (e.g. export in PDF)                                                             |
+------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ![](https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg-bookdown.png){width=70px}  | [bookdown](https://bookdown.org/) advanced editing and publishing functions (e.g. cross reference figures)                                                 |
+------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+

## Create a new document

In RStudio: `File > New file > R Markdown...`

![](www/rmd_create.png){width="500px"}

The options (`Title`, `Author`, `Date`, etc.) can be changed later (YAML header). Choose **PDF** as the default output format.

![](www/rmd_create_rmd.png){width="500px"}

## New created document

A new document is created:

![](www/rmd_create_rmd_new.png){width="700px"}

Run the new document with `knitr` <img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg-knitr.png" style="height: 40px;vertical-align: middle;"/>, it will launch the render

![](www/rmd_render.png){width="900px"}

## First R Markdown document

```{=html}
<script src="https://gist.github.com/zoometh/d1b4945d1c16f853a7888ede03c4807d.js"></script>
```

## RStudio tools

::: {.panel-tabset}

### Tools

<img src="www/rmd_nav_scriptWindowTopBar.png" alt=" " align="left"/>

+-------------------------------------+-------------------------------------------------+
| tool                                | description                                     |
+=====================================+=================================================+
| ![](www/rmd_nav_knitOnSave.png){width="60px"}     | knit automatically when save the document       |
+-------------------------------------+-------------------------------------------------+
| ![](www/rmd_nav_checkSpelling.png){width="60px"}  | check spelling                                  |
+-------------------------------------+-------------------------------------------------+
| ![](www/rmd_nav_knit.png){width="60px"}           | knit the document                               |
+-------------------------------------+-------------------------------------------------+
| ![](www/rmd_nav_mdFormatOpt.png){width="60px"}    | run [Visual R Markdown](#vrm) + other options |
+-------------------------------------+-------------------------------------------------+
| ![](www/rmd_nav_newCodeChunk.png){width="60px"}   | New code chunk (R, Bash, D3, Python, etc.)      |
+-------------------------------------+-------------------------------------------------+
| ![](www/rmd_nav_run.png){width="60px"}            | run a part or the whole document                |
+-------------------------------------+-------------------------------------------------+
| ![](www/rmd_nav_publish.png){width="60px"}        | publish the document                            |
+-------------------------------------+-------------------------------------------------+
| ![](www/rmd_nav_visualMdEditor.png){width="60px"} | run [Visual R Markdown](#vrm)                   |
+-------------------------------------+-------------------------------------------------+

### Visual R Markdown {#vrm}

<img src="www/rmd_nav_visualMdEditor_bar.png" align="left"/><br>
  
[Visual R Markdown](https://rstudio.github.io/visual-markdown-editing/) has a Pandoc syntax (extension of Mardown), supports [Zotero](https://www.zotero.org/) <img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/app-zotero.png" style="height: 45px;vertical-align: middle;"/>, can retrieve complete bibliographical references from DOI <img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/doi-logo.png" style="height: 45px;vertical-align: middle;"/> or searches on PubMed <img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/app-pubmed.png" style="height: 45px;vertical-align: middle;"/>, Crossref <img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/app-crossref.png" style="height: 45px;vertical-align: middle;"/>, and DataCite <img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/app-datacite.png" style="height: 45px;vertical-align: middle;"/>


:::

## Document structure

R Markdown combines

:::: {.columns}
::: {.column width="50%"}
-   a [YAML header](#yaml) for the document metadata

-   different [code chunks](#chunks) (R code embedded)

-   many [narrative parts](#text) (Markdown syntax) with inline R code
:::

::: {.column width="50%"}

![](www/rmd_create_rmd_new.png){width="700px"}

<center>
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  overflow:hidden;padding:10px 5px;word-break:normal;}
.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg .tg-lto5{background-color:#f8a102;border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-12h1{border-color:inherit;font-family:"Comic Sans MS", cursive, sans-serif !important;text-align:left;vertical-align:top}
.tg .tg-a6nh{background-color:#efefef;font-family:"Courier New", Courier, monospace !important;text-align:left;vertical-align:top}
.tg .tg-0lax{text-align:left;vertical-align:top}
.tg .tg-abk0{font-family:"Comic Sans MS", cursive, sans-serif !important;text-align:left;vertical-align:top}
</style>
<table class="tg">
<thead>
  <tr>
    <th class="tg-lto5">YAML header</th>
    <th class="tg-0lax"></th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-12h1">Lorem ipsum ...</td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-a6nh">```{r}<br>code chunk<br>```</td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-abk0">Lorem ipsum ...</td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-a6nh">```{r}<br>code chunk<br>```</td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-0lax" colspan="2">...</td>
  </tr>
</tbody>
</table>

</center>
:::
::::

## Markdown syntax

Easy-to-write plain text syntax

::: {.panel-tabset}

### In use

Used by different code-oriented frameworks: [Jupyter](https://hub.mybinder.turing.ac.uk/user/ipython-ipython-in-depth-qd7itkd2/notebooks/binder/Index.ipynb) <img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/app-jupyter.png" style="height: 45px;vertical-align: middle;"/>, [GitHub](https://github.com/zoometh/oxford/tree/main/R4Archaeologists#rmarkdown) <img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/app-github.png" style="height: 45px;vertical-align: middle;"/>, [Sketchfab](https://sketchfab.com/3d-models/roche-de-larcher-a5c0771d898d4816950570cd7fb1be37) <img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/app-sketchfab.png" style="height: 45px;vertical-align: middle;"/>, [Slack](https://eamena.slack.com/archives/D02KMQULWVD/p1637257246040200) <img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/app-slack.png" style="height: 45px;vertical-align: middle;"/>, [bookdown](https://martinhinz.github.io/smada2021/book/preface.html) <img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg-rmarkdown.png" style="height: 45px;vertical-align: middle;"/>, [Stackoverflow](https://stackoverflow.com/a/14747656/2854081) <img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/app-stackoverflow.png" style="height: 45px;vertical-align: middle;"/>, etc.

### Basic syntax

```{=html}
<iframe width="900" height="500" src="https://rmarkdown.rstudio.com/authoring_basics.html" title="Markdown basic syntax"></iframe>
```

https://rmarkdown.rstudio.com/authoring_basics.html

### Online editor

```{=html}
<iframe width="900" height="500" src="https://stackedit.io/app#" title="Markdown online editor"></iframe>
```

https://stackedit.io/app#

### Online converter

Pandoc is an extension of Markdown, usefull for text conversions (Markdown <-> HTML, LaTeX <-> Markdown, etc.)

```{=html}
<iframe width="900" height="500" src="https://pandoc.org/try/" title="Pandoc online convertor"></iframe>
```

https://pandoc.org/try/

:::

## Styling

::: {.panel-tabset}

### Text

+---------------------------------------+-------------------------------------+
| Markdown                              | Rendered                            |
+=======================================+=====================================+
| `**bold**, __bold__`                  | **bold**, **bold**                  |
+---------------------------------------+-------------------------------------+
| `*italic*, _italic_`                  | *italic*, *italic*                  |
+---------------------------------------+-------------------------------------+
| `code`                                | `code`                              |
+---------------------------------------+-------------------------------------+
| `hyphen -- inserted -- in a sentence` | hyphen -- inserted -- in a sentence |
+---------------------------------------+-------------------------------------+
| `H~2~O`                               | H~2~O                               |
+---------------------------------------+-------------------------------------+
| `10^−19^`                             | 10^−19^                             |
+---------------------------------------+-------------------------------------+
| ...                                   | ...                                 |
+---------------------------------------+-------------------------------------+

### Math formula

| Markdown                   | Rendered                 |
|----------------------------|--------------------------|
| `$$\sum_{i=1}^{n} X^3_i$$` | $$\sum_{i=1}^{n} X^3_i$$ |
| ...                        | ...                      |

### Others

-   blockquotes `>`

`> I am a blockquote`

> I am a blockquote

-   line separator

<!-- -->

    --- or ***


------------------------------------------------------------------------
:::

## Styling with HTML/CSS

A extended part of the text styling can also be done with HTML/CSS

## Lists {.unnumbered}

```{.md code-line-numbers="1"}
- numbered  
  
  1. first element
  2. second element
  3. third element 
```
- numbered  
  
  1. first element
  2. second element
  3. third element 


:::: {.columns}
::: {.column width="50%"}
    - numbered  
      
      1. first element
      2. second element
      3. third element 
:::

::: {.column width="50%"}
-   numbered

    1.  first element
    2.  second element
    3.  third element
:::
::::

## Lists {.unnumbered}

```{.md code-line-numbers="1"}
- bullet
  
  * first element
  * second element
  * third element
    - third element - sub 1
    - third element - sub 2
      + third element - sub 2 - subsub 1
      + third element - sub 2 - subsub 2
```
- bullet
  
  * first element
  * second element
  * third element
    - third element - sub 1
    - third element - sub 2
      + third element - sub 2 - subsub 1
      + third element - sub 2 - subsub 2
      
:::: {.columns}
::: {.column width="50%"}
    - bullet
      
      * first element
      * second element
      * third element
        - third element - sub 1
        - third element - sub 2
          + third element - sub 2 - subsub 1
          + third element - sub 2 - subsub 2
:::

::: {.column width="50%"}
-   bullet

    -   first element
    -   second element
    -   third element
        -   third element - sub 1
        -   third element - sub 2
            -   third element - sub 2 - subsub 1
            -   third element - sub 2 - subsub 2
:::
::::

## Tables {.unnumbered}

::: {.panel-tabset}

### Simple table

<center> Write </center> 


:::: {.columns}
::: {.column width="40%"}

```{.md code-line-numbers="1"}
- bullet
  
  * first element
  * second element
  * third element
    - third element - sub 1
    - third element - sub 2
      + third element - sub 2 - subsub 1
      + third element - sub 2 - subsub 2
```


```
| Header 1 | Header 2 |
| --- | ----------- |
| Row 1 | Text |
| Row 2 | Another text |
```

:::

::: {.column width="20%"}
<center> or </center> 
:::

::: {.column width="40%"}

```{.md code-line-numbers="1"}
| Header 1    | Header 2    |
| ----------- | ----------- |
| Row 1       | Text        |
| Row 2       | Another text|
```

```
| Header 1    | Header 2    |
| ----------- | ----------- |
| Row 1       | Text        |
| Row 2       | Another text|
```

:::
::::

<center> produce the same result: </center> 


| Header 1    | Header 2    |
| ----------- | ----------- |
| Row 1       | Text        |
| Row 2       | Another text|

### Alignements

Use `:----:`, `:---` or `---:` to align

<center> 

```{.md code-line-numbers="1"}
| Left        |    Center   |         Right |
| :---        |    :----:   |          ---: |
| Header      | Title       | Here's this   |
| Paragraph   | Text        | And more      |
```

```
| Left        |    Center   |         Right |
| :---        |    :----:   |          ---: |
| Header      | Title       | Here's this   |
| Paragraph   | Text        | And more      |
```

</center>


| Left      | Center |       Right |
|:----------|:------:|------------:|
| Header    | Title  | Here's this |
| Paragraph |  Text  |    And more |

### Complex tables

Table are often data structure difficult to layout. For complex tables you will need to use code chunks, e.g. kable() from {`knitr`} with [kable_styling()](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html) from {`kableExtra`}


```{r echo=TRUE}
library(kableExtra)
dt <- mtcars[1:5, 1:6]
dt %>%
  kbl() %>%
  kable_paper("hover", full_width = F)
```

```{r echo=TRUE}
dt %>%
  kbl(caption = "Recreating booktabs style table") %>%
  kable_classic(full_width = F, html_font = "Cambria")
```

:::

## Images

::: {.panel-tabset}

### Online images

Markdown notation

```{.md code-line-numbers="1"}
![](https://raw.githubusercontent.com/zoometh/thomashuet/master/teachings/stats/R4Archaeo/www/logo.png){width=100px}
```
![](https://raw.githubusercontent.com/zoometh/thomashuet/master/teachings/stats/R4Archaeo/www/logo.png){width=100px}

---

HTML notation

```{.md code-line-numbers="1"}
<img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/teachings/stats/R4Archaeo/www/logo.png" width=100>
```
<img src="https://raw.githubusercontent.com/zoometh/thomashuet/master/teachings/stats/R4Archaeo/www/logo.png" width=100>


### Local images

Markdown notation

```{.md code-line-numbers="1"}
![](www/logo.png){width=100px}
```
![](www/logo.png){width=100px}

---

HTML notation

```{.md code-line-numbers="1"}
<img src="www/logo.png" alt="" width=100>  
```
<img src="www/logo.png" alt="" width=100>  

:::

## Spaces and end of lines

::: {.panel-tabset}

### Spaces

Extra spaces (HTML only)

-     `&emsp;` means 4 spaces (= a tabulation)
-     `&ensp;` means 2 spaces
-     `&nbsp;` means 1 space

### End of line

End of line (`<br>` in HTML) with 2 or more spaces and return -- or `\` and return -- for example:

![](https://raw.githubusercontent.com/zoometh/thomashuet/master/teachings/stats/R4Archaeo/www/rmd_eol.png){width="400px"}

:::: {.columns}

::: {.column width="50%"}


```{.md code-line-numbers="1"}
Reconnais-toi  
Cette adorable personne c'est toi  
Sous le grand chapeau canotier  
Oeil
Nez  
Ta Bouche  
Voici l’ovale de ta figure  
Ton cou Exquis (Apollinaire, 1913)
```
Reconnais-toi  
Cette adorable personne c'est toi  
Sous le grand chapeau canotier  
Oeil
Nez  
Ta Bouche  
Voici l’ovale de ta figure  
Ton cou Exquis (Apollinaire, 1913)

:::

::: {.column width="50%"}

```{.md code-line-numbers="1"}
Reconnais-toi\
Cette adorable personne c'est toi\
Sous le grand chapeau canotier\
Oeil Nez\
Ta Bouche\
Voici l'ovale de ta figure\
Ton cou Exquis\
(Apollinaire, 1913)
```
Reconnais-toi\
Cette adorable personne c'est toi\
Sous le grand chapeau canotier\
Oeil Nez\
Ta Bouche\
Voici l'ovale de ta figure\
Ton cou Exquis\
(Apollinaire, 1913)

:::

::::


:::

## Titles


```{.md code-line-numbers="1"}
# Header level 1

## Header level 2

### Header level 3
```

    
## Numbering titles

+-------------------------------------+-------------------------------------------------+
| Avoid numbering                     | `## My Header level 2 {-}`                      |
+-------------------------------------+-------------------------------------------------+
| Avoid numbering and add an anchor   | `## My Header level 3 {-#bookmarks}`            |
+-------------------------------------+-------------------------------------------------+


## Hyperlinks {.unnumbered}

Add hyperlinks

::: {.panel-tabset}

### To text

```{.md code-line-numbers="1"}
part 2: [Practice](https://github.com/zoometh/thomashuet/tree/main/teachings/stats/R4Archaeo/2_R Markdown_Practice)
```
part 2: [Practice](https://github.com/zoometh/thomashuet/tree/main/teachings/stats/R4Archaeo/2_R Markdown_Practice)

### To images


```{.md code-line-numbers="1"}
[![](www/logo.png){width=170px}](https://www.unipi.it/index.php/humanities/item/16574-r4rchaeologists)
```
[![](www/logo.png){width="170px"}](https://www.unipi.it/index.php/humanities/item/16574-r4rchaeologists)


:::



## Bookmarks {#bookmarks .unnumbered}


```{.md code-line-numbers="1"}
After this theoretical part, you will have to [practice](#practice)
```
After this theoretical part, you will have to [practice](#practice)

---

This referenced section has the anchor `#practice` inside curly brackets:

```{.md code-line-numbers="1"}
# Practice {#practice}
```


## Footnotes {.unnumbered}

```{.md code-line-numbers="1"}
A simple footnote[^1]
...

[^1]: This is the first footnote.
```
A simple footnote[^1]
...

[^1]: This is the first footnote.


## Cross-referencing

Cite and reuse variables, figures, tables, sections, etc., through your document


## Variables {.unnumbered}

Outside the code chunks, variables are called like this <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/teachings/stats/R4Archaeo/www/rmd_call_var.png' style='height: 40px;vertical-align: middle;'>


```{r  echo=TRUE}
library(archdata)
data("Handaxes")
number.of.axes <- nrow(Handaxes)
```

```{.md code-line-numbers="1"}
Furze Platt dataset counts 'r number.of.axes'
```

---

Variables can be calculated also outside code chunks

```{.md code-line-numbers="1"}
Furze Platt dataset counts 'r number.of.axes' described by 'r ncol(Handaxes)'. The maximal length (L = 'r max(Handaxes$L)')
```

'Furze Platt dataset counts `r number.of.axes` described by `r ncol(Handaxes)`. The maximal length (L = `r max(Handaxes$L)`)'


## Figures {.unnumbered}

```{r maxLmaxB, echo=TRUE, out.width="100%", fig.align="center", fig.cap="Maximum Length/Maximum breadth in cm"}
library(archdata)
data("Handaxes")
plot(Handaxes$L, Handaxes$B)
model <- lm(B ~ L, data = Handaxes)
abline(lm(model))
```

```{.md code-line-numbers="1"}
the distribution of the maximum length (L) and maximum breadth (B) shows a R^2^ = 'r round(model$coefficients[2], 2)',  Fig. \@ref(fig:maxLmaxB))
```
the distribution of the maximum length (L) and maximum breadth (B) shows a R^2^ = 'r round(model$coefficients[2], 2)',  Fig. \@ref(fig:maxLmaxB)) 


## Bibliographic references

::: {.panel-tabset}

### BibTex format

File `.bib` referenced in the YAML header

<img src="www/rmd_create_rmd_new-bib.png" alt="rmd_yaml_bib" width="400"/>

<img src="www/rmd_bib.png" alt="rmd_bib" width="600"/>


### Cross citation in text

+---------------------------------------------+-------------------------------------------+
| code in R Markdown                          | Render                                    |
+=============================================+===========================================+
| `@Xie22`                                    | @Xie22                                    |
+---------------------------------------------+-------------------------------------------+
| `[@Xie22]`                                  | [@Xie22]                                  |
+---------------------------------------------+-------------------------------------------+
| `[credits: @Xie22]`                         | [credits: @Xie22]                         |
+---------------------------------------------+-------------------------------------------+
| `published by Yihui Xie [-@Xie20; -@Xie22]` | published by Yihui Xie [-@Xie20; -@Xie22] |
+---------------------------------------------+-------------------------------------------+
| ...                                         | ...                                       |
+---------------------------------------------+-------------------------------------------+

Exemple:

```{.md code-line-numbers="1"}
[Bibliographies and citations](https://bookdown.org/yihui/rmarkdown-cookbook/bibliography.html#bibliography) [@Xie20]
```
[Bibliographies and citations](https://bookdown.org/yihui/rmarkdown-cookbook/bibliography.html#bibliography) [@Xie20]

:::

## Code chunks {#chunks}

Placeholders for the coding part of the document

![](www/rmd_codechunk_header.png)
## Headers

::: {.panel-tabset}


### Headers options

```{r munsingenspat, echo = TRUE, warning = FALSE, message = FALSE}```

Options are used to show/hide the code, change the size of the output image, set the alignment of the ouptut, etc. 

### Options hierarchy 

The first top chunk (the first one in the document) allows to set these options for all other chunks, e.g. `knitr::opts_chunk$set(echo = TRUE)` will 'echoing' all chunks unless you change these options in the following headers

```{=html}
<iframe width="780" height="500" src="https://github.com/zoometh/thomashuet/blob/0abe7d110af2273f349a3059dd187421a9f9ea12/teachings/stats/R4Archaeo/temp.Rmd#L8" title="top chunk"></iframe>
```

:::

### Tools



<img src="www/rmd_nav_mdFormatOpt.png" alt=" " align="left"/>  graphical interface for options

<img src="www/rmd_codechunk_header_runabove.png" alt=" " align="left"/>  run the previous chunks but not this one

<img src="www/rmd_codechunk_header_runthis.png" alt=" " align="left"/>  run this chunk

## Code evaluation {.unnumbered}

<table>
<thead>
  <tr>
    <th>code</th>
    <th>description</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>`include = FALSE`</td>
    <td>prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.</td>
  </tr>
  <tr>
    <td>`echo = FALSE`</td>
    <td>prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.</td>
  </tr>
  <tr>
    <td>`message = FALSE`</td>
    <td>prevents messages that are generated by code from appearing in the finished file.</td>
  </tr>
  <tr>
    <td>`warning = FALSE`</td>
    <td>prevents warnings that are generated by code from appearing in the finished.</td>
  </tr>
</tbody>
</table>

-   `include = FALSE` prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.

-   `echo = FALSE` prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.

-   `message = FALSE` prevents messages that are generated by code from appearing in the finished file.

-   `warning = FALSE` prevents warnings that are generated by code from appearing in the finished.

## Graphics options {.unnumbered}


<table>
<thead>
  <tr>
    <th>code</th>
    <th>description</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>`fig.cap = "..."`</td>
    <td> adds a caption to graphical results.</td>
  </tr>
  <tr>
    <td>`fig.height = 7`</td>
    <td>height to use in R for plots created by the chunk (in inches).</td>
  </tr>
  <tr>
    <td>`fig.width = 7``</td>
    <td>width to use in R for plots created by the chunk (in inches).</td>
  </tr>
  <tr>
    <td>`fig.align = default`</td>
    <td>how to align graphics in the final document. One of 'left', 'right', or 'center'.</td>
  </tr>
    <tr>
    <td>`fig.pos = 'H'`</td>
    <td>fix the output exactly here.</td>
  </tr>
</tbody>
</table>


Options of the graphical results

-   `fig.cap = "..."` adds a caption to graphical results.

-   `fig.height = 7` height to use in R for plots created by the chunk (in inches)

-   `fig.width = 7` width to use in R for plots created by the chunk (in inches)

-   `fig.align = default` how to align graphics in the final document. One of 'left', 'right', or 'center'

-   `fig.pos = 'H'` fix the output exactly here

## Body

The body of a code chunk is <notes>where you place the R code</notes> you have scripted.

## Images {.unnumbered}

Images can be render inside a code chunk with `knitr::include_graphics("path/to/image")`

```{r munsingenfib, echo=TRUE, out.width = "30%", fig.align="center", fig.cap= "Fibulae measurements (Hodson, 1970)"}
knitr::include_graphics("www/munsingen_fib_measures.png") 
```

## YAML header {#yaml}

<img src="www/rmd_yaml.png"/>

This is the document header, it contains the metadata (e.g, Title, Authors, date) and the document configuration (e.g. HTML or PDF rendering, table of content). It is composed on key-value pairs:

```{.yml code-line-numbers="1"}
title: "temp"
output: pdf_document
date: '2023-02-05'
```

```{=html}
<iframe width="780" height="500" src="https://github.com/zoometh/thomashuet/blob/0abe7d110af2273f349a3059dd187421a9f9ea12/teachings/stats/R4Archaeo/temp.Rmd#L2" title="top chunk"></iframe>
```

## YAML header, dates


```{.yml code-line-numbers="1"}
title: "temp"
output: pdf_document
date: "`r format(Sys.time(), '%D')`"
```

`r format(Sys.time(), '%D')`

```{=html}
<iframe width="780" height="200" src="https://github.com/zoometh/thomashuet/blob/0abe7d110af2273f349a3059dd187421a9f9ea12/teachings/stats/R4Archaeo/1_Rmarkdown_Theory.Rmd#L4" title="R variable"></iframe>
```

---

```{.yml code-line-numbers="1,2,3"}
title: "temp"
output: pdf_document
date: "`r format(Sys.time(), '%d %B %Y')`"
```
`r format(Sys.time(), '%d %B %Y')`


`title`: Title

`author`: Author

`date`:\
 `"03/02/2022"`\
 "03/02/2022"\
 `"'r '"`\
 "`r format(Sys.time(), '%D')`"\
 `"'r format(Sys.time(), '%d %B %Y')'"`\
 "`r format(Sys.time(), '%d %B %Y')`"\
 ...

## YAML header, output

```{=html}
<iframe width="780" height="200" src="https://github.com/zoometh/thomashuet/blob/0abe7d110af2273f349a3059dd187421a9f9ea12/teachings/stats/R4Archaeo/temp.Rmd#L3" title="knit output"></iframe>
```



`output`:\
 `html_document`\
 `pdf_document`\
 ...\
 `pdf_document:`\
  `toc: yes`
  

## YAML header, TOC

`toc`: table of contents\
 `toc: yes`\
 `toc_depth: 4`\
 `toc_float:`\
  `collapsed: no`\
  ...

## YAML header, references

Link to the bibliographic references file (e.g.  [`references.bib`](https://github.com/zoometh/oxford/blob/main/R4A/references.bib))

```{.yml code-line-numbers="4"}
title: "temp"
output: pdf_document
date: "`r format(Sys.time(), '%d %B %Y')`"
bibliography: references.bib
```


## YAML header, references

```{=html}
<iframe width="780" height="200" src="https://bookdown.org/yihui/rmarkdown/html-document.html#html-document" title="YAML for R Markdown"></iframe>
```

![](www/info_darkblue.png){width="20px"} [YAML for R Markdown](https://bookdown.org/yihui/rmarkdown/html-document.html#html-document) [@Xie18]

## HTML/CSS

Can be use in all parts of the document (YAML header, code chunks, narrative parts)

## Styling

```{.html code-line-numbers="4"}
<span style='font-size: 30px'>Big font</span>
```
<span style='font-size: 30px'>Big font</span>

---

```{.html code-line-numbers="4"}
<b>bolded</b>
```
<b>bolded</b> 

---

```{.html code-line-numbers="4"}
<span style="color:red">red</span>
```
<span style="color:red">red</span>


+-------------------------------------------------+-------------------------------------+
| HTML notation                     | Render                              |
+=================================================+=====================================+
| `<span style='font-size: 30px'>Big font</span>` | [Big font]{style="font-size: 30px"} |
+-------------------------------------------------+-------------------------------------+
| `<b>bolded</b>`                                 | <b>bolded</b>                       |
+-------------------------------------------------+-------------------------------------+
| `<span style="color:red">red</span>`            | [red]{style="color:red"}            |
+-------------------------------------------------+-------------------------------------+
| ...                                             | ...                                 |
+-------------------------------------------------+-------------------------------------+

```{.md code-line-numbers="1"}
Customize the document with CSS layouts like <notes>this CSS element with a **dodgerblue** for background and white for text</notes> here: https://github.com/zoometh/thomashuet/blob/main/teachings/stats/R4Archaeo/styles.css
```
Customize the document with CSS layouts like <notes>this CSS element with a **dodgerblue** for background and white for text</notes>

## HTML online editor

```{=html}
<iframe width="780" height="200" src="https://www.w3schools.com/tryit/tryit.asp?filename=tryhtml_hello" title="YAML for R Markdown"></iframe>
```

![](www/info_darkblue.png){width="20px"} [HTML online editor](https://www.w3schools.com/tryit/tryit.asp?filename=tryhtml_hello)

## Interactivity

::: {.panel-tabset}

### Shiny

HTML allows online interactive settings. R offers a real framework to create interactive documents, [Shiny](https://shiny.rstudio.com/). Shiny can be integrated into R Markdown

Try: `File > New File > Rmarkdown > Shiny`, or in the YAML header:

```{.md code-line-numbers="4"}
runtime: shiny
```
        

### Maps

With the {`leaflet`} package

```{r munsingenspat, echo=TRUE, warning = FALSE, message = FALSE}
library(dplyr)
library(leaflet)
munsingen.long <- 7.569587484129203
munsingen.lat <- 46.864709895956004
leaflet(width = "60%", height = "400px") %>%
  addTiles(group = 'OSM') %>%
  addControl("Munsingen necropolis", position = "bottomright") %>%
  addProviderTiles(providers$Esri.WorldImagery, group='Esri.WorldImagery') %>%
  addMarkers(munsingen.long,
             munsingen.lat,
             label = "Munsingen necropolis") %>%
  addLayersControl(
    baseGroups = c('OSM', 'Esri.WorldImagery')) %>%
  addScaleBar(position = "bottomleft")
```

### Plots 2D

With the {`plotly`} package

```{r munsingenplot2D, message=FALSE, echo=TRUE, warning = FALSE}
library(plotly)
library(dplyr)
library(archdata)
data("Fibulae")
Fibulae.ex <- Fibulae
Fibulae.ex$lbl <- paste0("<b>Museum num.: ", Fibulae.ex$Mno, "</b><br>",
                          "Length: ", Fibulae.ex$Length, "<br>",
                          "Foot Angle: ", Fibulae.ex$FA, "<br>")
plot_ly(data = Fibulae.ex, 
        x = ~Length,
        y = ~FA,
        text = ~lbl,
        hoverinfo = "text") %>% 
  layout(title = "Munsingen fibulae")
```

### Plots 3D

With the {`rgl`} package

```{r munsingenplot3D, echo=TRUE, out.width="25%"}
library(rgl)
options(rgl.useNULL = TRUE) # avoid the popup RGL device
nb.samp <- 12
# 12 graves with the numerous fibulae
Fibulae.nbGrave <- Fibulae %>% 
  count(Grave) %>%
  arrange(-n) %>%
  slice_head(n = nb.samp)
Fibulae.samp <- Fibulae[Fibulae$Grave %in% Fibulae.nbGrave$Grave, ]
# rainbow colors by graves
Fibulae.samp$color <- rainbow(nb.samp)[as.numeric(as.factor(Fibulae.samp$Grave))]
plot3d(
  x = Fibulae$Length,
  y = Fibulae$FA,
  z = Fibulae$BH, 
  col = Fibulae.samp$color, 
  type = 's', 
  xlab = "Length", 
  ylab  ="Foot Angle",
  zlab = "Bow Height")
rglwidget()
```

:::


## Export document

Export R Markdown in: HTML, PDF, LaTeX, Word, ODT, RTF, Markdown, etc. (see: https://rmarkdown.rstudio.com/lesson-9.html)

## HTML

Basic. HTML export is the default option of a R Markdown document.

## PDF

Harder. PDF uses LaTeX syntax, if you don't have [MiKTeX](https://miktex.org/) installed, you need to install the [{tinytex}](https://yihui.org/tinytex/r/) package \[Xie19\].

    install.packages('tinytex')
    tinytex::install_tinytex()
    # .rs.restartR()

To export in PDF, change the YAML key-value pair `bookdown::html_document2:` to `bookdown::pdf_document2:` and knit. These temporary files are creates:

<img src="www/rmd_knit_pdf.png" alt=" "/>

At the end of the render these files are deleted

## LaTeX

LaTeX (extension of TeX) is a rich plain text syntax for academic writing. To export in TeX, select in the YAML header a PDF export + keep tex:

        bookdown::pdf_document2: 
            keep_tex: true

![](www/info_darkblue.png){width="20px"}  Alongside [Pandoc](https://pandoc.org/try/), exists a lot of online apps making the conversions easier (e.g. [Word to HTML](https://wordtohtml.net/))

## Publishing on platforms

-   [Rpubs](https://rpubs.com/)
    -   after Render: <img src="www/rmd_publish_Rpubs.png"/>
-   GitHub/GitLab, the same document is accessible by different means:
    -   formatted: https://github.com/zoometh/oxford/blob/main/R4A/helloworld.html
    -   raw: https://raw.githubusercontent.com/zoometh/oxford/main/R4A/helloworld.html
    -   HTML: https://zoometh.github.io/oxford/R4A/helloworld.html
    -   downloadable: *see below*

## Practice {#practice}

**1)** Use `1_Rmarkdown_Theory.Rmd` as a model (copy/paste code snippets, Mardown syntax, etc.):

-   view: https://github.com/zoometh/oxford/blob/main/R4A/1_Rmarkdown_Theory.Rmd
-   download: https://zoometh.github.io/oxford/R4A/1_Rmarkdown_Theory.Rmd

**2)** `2_Rmarkdown_Practice.Rmd` gives an example of the desired structure for the Practice part:

-   view: https://github.com/zoometh/oxford/blob/main/R4A/2_Rmarkdown_Practice.Rmd
-   download: https://zoometh.github.io/oxford/R4A/2_Rmarkdown_Practice.Rmd

**3)** `references.bib`is the document where you will add the bibliographic references of the practice part. Google Scholar is a nice tool to copy/paste BibTex references, e.g. [this reference](https://scholar.google.fr/scholar?hl=en&as_sdt=0%2C5&q=The+British+Lower+and+Middle+Paleolithic%3A+some+problems%2C+methods+of+study+and+preliminary+results&btnG=#):

-   view: https://github.com/zoometh/oxford/blob/main/R4A/references.bib
-   download: https://zoometh.github.io/oxford/R4A/references.bib

**4)** choose a dataset of those available in the {`archdata`} package (e.g. 'Handaxes'), you will have to analyse these data/reuse the code you have already created (run `?archdata` to see the list of these dataset)

## References
